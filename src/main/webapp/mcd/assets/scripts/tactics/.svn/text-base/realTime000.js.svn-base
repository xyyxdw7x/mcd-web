	$(function(){
		$(document).on(".btn-ok","click",function(){
			$('#openAddOpportunity').modal('hide')
		});
	});
	
	//点击添加实时事件按钮初始化弹出页面的数据
	function initVirtualNetScene(){
		 $.ajax({
				url:_ctx + '/mpm/imcdChannelExecuteAction.aido?cmd=initRuleTimeTermLable',
				type : "POST",
				data : {},
				success : function(result) {
					
					var json = result.data;
					var htmlStr = '';
					for(var i=0;i<json.length;i++){
						var name = json[i].name;
						var value = json[i].value; 
						htmlStr += '<label class="col-md-3">'+name+'</label><div class="col-md-9"><ul class="clearfix opportunity-box">';
						for(var j=0;j<value.length;j++){
							var functionId = value[j].functionId;
							var functionNameDesc = value[j].functionNameDesc;
							htmlStr += '<li functionId="'+functionId+'" onclick="getRandomCustGroup(this)">'+functionNameDesc+'</li>';
						}
						htmlStr += "</ul></div>";
					}
					$("#virtualNetScene").html(htmlStr);
				}
			});
	}
	/* 初始化客户群清单数据，客户群id暂时写死   ???????????????????????????  */
	function getRandomCustGroup(obj){
		$(".opportunity-box > li").removeClass("active"); 
		$(obj).addClass("active") ;
		
		
		
		querySysPack();
		
		/*var html = new EJS({url: _ctx+'/mcd/pages/EJS/CEP/addOpportunity.ejs'}).render({modalHeader:$(obj).text()})
		$("#modalGrounp").html(html); 
		var htmlStr = "";
		 $.ajax({
			url:_ctx + '/mpm/imcdChannelExecuteAction.aido?cmd=getRandomCustGroup',
			type : "POST",
			data : {
				custGroupId : 1//$(obj).attr("functionId")
			},
			success : function(result) {
				var json = result.data;
				for(var i=0;i<json.length;i++){
					var attr1 = json[i].productNo;
					var attr2 = json[i].attrCol; 
					if(attr2=="" || attr2==undefined){
						attr2 ="";
					} 
					if(attr2==""){
						htmlStr += '<li><span>'+attr1 +',</span><span class="del-phone-num glyphicon glyphicon-remove"></span></li>';
					}else{
						htmlStr += '<li><span>'+attr1 +',</span><span>'+attr2 +'</span><span class="del-phone-num glyphicon glyphicon-remove"></span></li>';
					}
				}
//				console.log(htmlStr)
				$("#phoneNums").html(htmlStr);
			}
		});  */
	}
	//查询我的常用词包
	function queryCommonPack(){
		
		$.ajax({
			url:_ctx + '/mpm/mtlCepNetUrlAction.aido?cmd=queryUrlPacks&isSysPack=0',
			type : "POST",
			success : function(result) {
				var commonPack=result.data;	
				debugger;
				var html = new EJS({url: _ctx+'/mcd/pages/EJS/CEP/myCommUrlPack.ejs'}).render({commonPack:commonPack});
				$("#profile1").html(html); 
			}
		}); 
		
	}
	
	//查询系统预置的包
	function querySysPack(){
		
				
		$.ajax({
			url:_ctx + '/mpm/mtlCepNetUrlAction.aido?cmd=queryUrlPacks&isSysPack=1',
			type : "POST",
			success : function(result) {		
				var hotPack=result.data;			
				var html = new EJS({url: _ctx+'/mcd/pages/EJS/CEP/accessnet.ejs'}).render({hotPack:hotPack});
				$("#modalGrounp").html(html); 
				
				
				
				var packName="",netUrls="";
				
				$("#_isSaveToMyCommon").on("click",function(){
					 if($("#_isSaveToMyCommon").is(':checked')){ 
						 $("#_packName").show();
					 }else{
						 alert(2);
						 $("#_packName").hide();
					 }
					
				})
				
				$("#selectURL").on("click",function(){
					 
					 $('li.selected-item').each(function(){
						 netUrls+= $(this).html()+" ";
					 });
					 packName= $("#_packName").val();			 
					 
					 if(packName&&netUrls){//复选框选中时，需要将数据传后台保存
						 var _myData="netUrls="+netUrls+"&packName="+packName;				 
						 $.ajax({
								url:_ctx + '/mpm/mtlCepNetUrlAction.aido?cmd=saveUrlPacks',
								type : "POST",
								data:_myData,
								async: false,
								success : function(result) {
									if(result.status=="200"){
										alert("保存常用包成功")
									}else{
										alert("保存常用包异常");
										return;
									}
								}
							}); 
					 }else{
						 alert("没有输入报名，或者包中没有添加url,无法保存为常用包！！！");
					 }
					 
					//拼数据传给父页面，关闭当前页面。
					
				});
			}
		}); 
		
		//选择url
		$(document).on("click","span.urlItem",function(){
			var selectHtml;
			selectHtml = $(this).html();
			if($(this).attr("isSelected")!=1){
				var li = $('<li class="selected-item"></li>').append(selectHtml);
				$("li#_cepIput").before(li);
				$(this).attr("isSelected","1");
			}else{
				alert("该url已被选中，不可重复选中！！");
			}
			
		});
		//输入已选后回车
		$(document).on("keyup","#cepAddItems",function(event){
			var currentVal = $(this).val();
			console.log(event.keyCode);
			if(currentVal.length>0){
				if(event.keyCode == 13){
					$(this).parent().before('<li class="selected-item">'+this.value+'</li>');
					var lis = $(".J_getWidth >li:not('.cep-input')");
					var liWidth = 0;
					for(var i =0;i<lis.length;i++){
						liWidth+=($(lis[i]).width()+60); 
					}
					
					var width = ($(".J_getWidth").width()-liWidth)<80?80:$(".J_getWidth").width()-liWidth;
					$(this).width(width);
					this.value = "";
				} 
			}
			if(event.keyCode == 8){
				if(this.value.length == 0){
					$(this).parent().prev().remove(); 
				}
			}
		});
	}
	
	function loadContentNetClass(){
		$.ajax({
			url:_ctx + '/mpm/mtlCepNetUrlAction.aido?cmd=queryContentNetClasses',
			type : "POST",
			success : function(result) {		
				var data=result.data;
				var rootClass=[];
				for(var s=0;s<data.length;s++){
					if(data[s].netClassPid==0){
						rootClass.push(data[s]);
					}
				}
				for(var m=0;m<rootClass.length;m++){
					var tempNetArray=[];//子分类
					for(var n=0;n<data.length;n++){
						if(rootClass[m].netClassId==data[n].netClassPid){
							tempNetArray.push(data[n]);
						}
					}
					rootClass[m].subClass=tempNetArray;
				}
						
				var html = new EJS({url: _ctx+'/mcd/pages/EJS/CEP/contentNetClass.ejs'}).render({netClasses:rootClass});
				$("#settings").html(html); 
			}
		}); 
		
		
			$(document).on("click",".keyword-items-type > li",function(){
				if($(this).hasClass("active")){
					$(this).removeClass("active");
					$("li[target-id='"+this.id+"']").remove();
				}else{
					$(this).addClass("active");
					var parentHtml = $(this).parent().prev().find("span:first-child").text();
					$("#keyWordItems").append('<li target-id="'+this.id+'">'+parentHtml+'》'+$(this).text()+'</li> ');
				} 
			});
		
	}
	
	//手机号码格式校验 
	function checkPhoneNoPattern(){
		var phoneNoStr = $(".opportunity-phone >li>span").text();
		//phoneNoStr += '123343,'
		//alert(phoneNoStr);
		var phoneNo = phoneNoStr.substring(0,phoneNoStr.length-1).split(",");
		//alert(phoneNo);
		var reg = /^0?1[3|4|5|8][0-9]\d{8}$/;
		var errorPhone = [];
		for(index in phoneNo){
			var phone = phoneNo[index];
			if(!reg.test(phone)){
				errorPhone.push(phone);
			}
		}
		if (errorPhone.length==0) {
		     alert('客户群号码正确');
		}else{
		     alert('手机号码'+errorPhone.toString()+'异常');
		};
	}
	
	//点击确定 回填实时事件变量        sceneId暂时写死
	function confirm1(){
		var htmlStr = "";
		$.ajax({
			url:_ctx + '/mpm/imcdChannelExecuteAction.aido?cmd=initRuleTimeTermSonLable',
			type : "POST",
			data : {
				sceneId : 1
			},
			success : function(result) {
				var chooseVarsli = $('.channelPreDefineList[channelid="901"] .chooseVars');
				var json = result.data;
				for(var i=0;i<json.length;i++){
					var paramId = json[i].paramId;
					var paramName = json[i].paramName; 
					htmlStr += '<li attrcol="'+paramId+'">'+paramName+'</li>';
				}
				chooseVarsli.append(htmlStr);
				$('#openAddOpportunity').modal('hide');
			}
		});
		
	}
